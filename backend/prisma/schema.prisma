generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

//////////////////////
// ENUMS
//////////////////////

enum Role {
  USER
  ADMIN
  SELLER
}

enum UserType {
  INDIVIDUAL
  LEGAL_ENTITY
}

enum OrderStatus {
  PENDING
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

enum DDI {
  BRA_55
  USA_1
  ARG_54
  CHI_56
  URU_598
  PAR_595
}

enum DDD {
  DDD_11
  DDD_12
  DDD_13
  DDD_14
  DDD_15
  DDD_16
  DDD_17
  DDD_18
  DDD_19
  DDD_21
  DDD_22
  DDD_24
  DDD_27
  DDD_28
  DDD_31
  DDD_32
  DDD_33
  DDD_34
  DDD_35
  DDD_37
  DDD_38
  DDD_41
  DDD_42
  DDD_43
  DDD_44
  DDD_45
  DDD_46
  DDD_47
  DDD_48
  DDD_49
  DDD_51
  DDD_53
  DDD_54
  DDD_55
  DDD_61
  DDD_62
  DDD_63
  DDD_64
  DDD_65
  DDD_66
  DDD_67
  DDD_68
  DDD_69
  DDD_71
  DDD_73
  DDD_74
  DDD_75
  DDD_77
  DDD_79
  DDD_81
  DDD_82
  DDD_83
  DDD_84
  DDD_85
  DDD_86
  DDD_87
  DDD_88
  DDD_89
  DDD_91
  DDD_92
  DDD_93
  DDD_94
  DDD_95
  DDD_96
  DDD_97
  DDD_98
  DDD_99
}

//////////////////////
// USER & AUTH
//////////////////////

model User {
  id       String   @id @default(uuid())
  name     String?
  email    String   @unique
  password String
  image    String?
  role     Role     @default(USER)
  userType UserType @default(INDIVIDUAL)
  document String   @unique
  isActive Boolean  @default(true)

  addresses     Address[]
  phones        Phone[]
  reviews       Review[]
  orders        Order[]
  cart          Cart?
  wishlist      Wishlist?
  chatbotLogs   ChatBot[]
  refreshTokens RefreshToken[]

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  @@index([email])
  @@map("users")
}

model RefreshToken {
  id        String   @id @default(uuid())
  token     String   @unique
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  expiresAt DateTime
  createdAt DateTime @default(now())
}

//////////////////////
// ADDRESS & PHONE
//////////////////////

model Address {
  id           String  @id @default(uuid())
  street       String
  number       String
  complement   String?
  neighborhood String
  city         String
  state        String
  country      String  @default("Brasil")
  zipCode      String
  isDefault    Boolean @default(false)

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  @@map("addresses")
}

model Phone {
  id          String @id @default(uuid())
  ddi         DDI    @default(BRA_55)
  ddd         DDD
  numberPhone String

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("phones")
}

//////////////////////
// PRODUCT CATALOG
//////////////////////

model Product {
  id            String   @id @default(uuid())
  name          String
  slug          String   @unique
  description   String
  price         Decimal
  discountPrice Decimal?
  stock         Int      @default(0)
  sku           String   @unique

  weight Float?
  height Float?
  width  Float?
  length Float?
  color  String?

  categoryId String
  category   Category @relation(fields: [categoryId], references: [id])

  brandId String?
  brand   Brand?  @relation(fields: [brandId], references: [id])

  images        ProductImage[]
  reviews       Review[]
  orderItems    OrderItem[]
  cartItems     CartItem[]
  wishlistItems WishlistItem[]

  materialId String?
  material   Material? @relation(fields: [materialId], references: [id])
  riskId     String?
  risk       Risk?     @relation(fields: [riskId], references: [id])

  isActive Boolean @default(true)

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  @@index([slug])
  @@index([sku])
  @@map("products")
}

model ProductImage {
  id     String  @id @default(uuid())
  url    String
  isMain Boolean @default(false)

  productId String
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@map("product_images")
}

model Category {
  id       String  @id @default(uuid())
  name     String
  slug     String  @unique
  imageUrl String?

  parentId String?
  parent   Category?  @relation("CategoryTree", fields: [parentId], references: [id])
  children Category[] @relation("CategoryTree")

  products Product[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("categories")
}

model Brand {
  id      String  @id @default(uuid())
  name    String  @unique
  logoUrl String?

  products Product[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("brands")
}

//////////////////////
// SHOPPING
//////////////////////

model Review {
  id      String  @id @default(uuid())
  rating  Int
  comment String?

  userId String
  user   User   @relation(fields: [userId], references: [id])

  productId String
  product   Product @relation(fields: [productId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, productId])
  @@map("reviews")
}

model Cart {
  id     String @id @default(uuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  items CartItem[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("carts")
}

model CartItem {
  id       String @id @default(uuid())
  quantity Int    @default(1)

  cartId String
  cart   Cart   @relation(fields: [cartId], references: [id], onDelete: Cascade)

  productId String
  product   Product @relation(fields: [productId], references: [id])

  @@unique([cartId, productId])
  @@map("cart_items")
}

model Order {
  id            String        @id @default(uuid())
  orderNumber   String        @unique
  totalAmount   Decimal
  status        OrderStatus   @default(PENDING)
  paymentStatus PaymentStatus @default(PENDING)
  paymentMethod String?

  shippingAddress String

  userId String
  user   User   @relation(fields: [userId], references: [id])

  items OrderItem[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("orders")
}

model OrderItem {
  id       String  @id @default(uuid())
  quantity Int
  price    Decimal

  orderId String
  order   Order  @relation(fields: [orderId], references: [id], onDelete: Cascade)

  productId String
  product   Product @relation(fields: [productId], references: [id])

  @@map("order_items")
}

model Wishlist {
  id     String @id @default(uuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  items WishlistItem[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("wishlists")
}

model WishlistItem {
  id String @id @default(uuid())

  wishlistId String
  wishlist   Wishlist @relation(fields: [wishlistId], references: [id], onDelete: Cascade)

  productId String
  product   Product @relation(fields: [productId], references: [id])

  @@unique([wishlistId, productId])
  @@map("wishlist_items")
}

//////////////////////
// EXTRA
//////////////////////

model Material {
  id       String  @id @default(uuid())
  name     String
  type     String?
  imageUrl String?

  products Product[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("materials")
}

model Risk {
  id             String  @id @default(uuid())
  name           String
  description    String?
  riskForPeople  String?
  riskForProduct String?

  products Product[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("risks")
}

model ChatBot {
  id       String @id @default(uuid())
  query    String
  response String

  userId String?
  user   User?   @relation(fields: [userId], references: [id], onDelete: SetNull)

  createdAt DateTime @default(now())

  @@map("chatbot_logs")
}
